<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>光與顏色模擬實驗(Light and color simulation experiment)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 工業風：深色背景，高對比文字，去除圓角 */
        body { font-family: 'Inter', sans-serif; min-height: 100vh; background-color: #1a1a1a; }
        
        /* 自定義滑桿樣式，使其更具機械感 */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 4px; /* 變為方形 */
            cursor: pointer;
            margin-top: -7px;
            border: 1px solid #EAEAEA;
            transition: all 0.2s;
        }
        /* 針對不同顏色的滑桿設定拇指顏色 */
        #lightR::-webkit-slider-thumb { background: #FF3333; box-shadow: 0 0 5px rgba(255, 0, 0, 0.7); }
        #lightG::-webkit-slider-thumb { background: #33CC33; box-shadow: 0 0 5px rgba(0, 255, 0, 0.7); }
        #lightB::-webkit-slider-thumb { background: #3366FF; box-shadow: 0 0 5px rgba(0, 0, 255, 0.7); }
        /* 滑軌顏色使用深色背景上的高亮漸變 */
        .slider-track-red { background: linear-gradient(to right, #444444, #FF3333); height: 5px; border-radius: 0; }
        .slider-track-green { background: linear-gradient(to right, #444444, #33CC33); height: 5px; border-radius: 0; }
        .slider-track-blue { background: linear-gradient(to right, #444444, #3366FF); height: 5px; border-radius: 0; }
        
        /* 按鈕外框樣式，原用於選中國旗 (已移除但保留以防未來使用) */
        .flag-container {
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 2px;
        }
        .flag-container:hover {
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            border-color: #FFD700;
        }
        .flag-selected {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }

        /* 關鍵 CSS：用於模擬色光照射效果 */
        /* mix-blend-mode: multiply (相乘) 模擬了色光和顏料 (反射) 的減法行為 */
        .light-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* 設置混合模式為相乘 */
            mix-blend-mode: multiply; 
            transition: background-color 0.3s;
        }

        /* 下拉選單樣式修正 */
        #flagSelect {
            /* 繼承工業風背景和文字顏色 */
            background-color: #444444; 
            color: #EAEAEA;
            border: 1px solid #606060;
            padding: 10px;
            font-size: 1rem;
            -webkit-appearance: none; /* 移除瀏覽器預設樣式 */
            -moz-appearance: none;
            appearance: none;
            cursor: pointer;
        }
        /* 讓下拉選單在不同設備上有更好的響應性 */
        .select-wrapper {
            position: relative;
        }
        .select-wrapper::after {
            content: '▼'; /* 自定義下拉箭頭 */
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            color: #FFD700;
            pointer-events: none; /* 讓點擊穿透到 select */
        }

    </style>
</head>
<body class="p-4 sm:p-8 flex items-start justify-center flex-col">
    <!-- 為了讓 footer 也能居中並設定 max-w，調整 body 樣式為 flex-col -->

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // 工業風格配色
                        'industrial-bg': '#1a1a1a',      // 深黑色背景
                        'panel-bg': '#2c2c2c',           // 控制面板深灰色
                        'text-light': '#EAEAEA',         // 亮白色文字
                        'border-accent': '#606060',      // 金屬色邊框
                        'warning-accent': '#FFD700',     // 黃色強調色
                    }
                }
            }
        }
    </script>

    <!-- 主容器：採用深灰背景，邊緣銳利，強烈邊框 (優化手機內邊距 p-4) -->
    <div class="w-full max-w-5xl bg-gray-800 border-2 border-border-accent shadow-2xl rounded-sm p-4 sm:p-8">
        <!-- 網頁標題 (優化手機字體大小 text-2xl) -->
        <h1 class="text-2xl sm:text-3xl font-bold text-text-light mb-2 text-center border-b-2 border-border-accent pb-2">
            光與顏色模擬實驗(Light and color simulation experiment)
        </h1>
        <!-- 版本編號註記 -->
        <div class="text-xs text-right text-gray-500 mb-4">版本: 1.0.1</div>

        <!-- 結構化網格 (手機堆疊，平板以上兩欄) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

            <!-- 左側：輸入控制面板 (色光混合) -->
            <div class="bg-panel-bg p-6 rounded-sm border border-border-accent">
                <!-- 實驗 1 標題 -->
                <h2 class="text-xl font-semibold mb-6 text-warning-accent border-b border-border-accent pb-2">
                    1. 色光混合模擬 (Color light mixing simulation)
                </h2>
                
                <!-- 紅光控制 -->
                <div class="mb-4">
                    <!-- Label and Input Field Container -->
                    <div class="flex justify-between items-center mb-1">
                        <label for="lightR" class="text-lg font-mono text-text-light">紅光強度 (Red light intensity)</label>
                        <!-- 數字輸入框 -->
                        <input type="number" id="inputR" min="0" max="255" value="0" 
                               class="w-20 bg-gray-700 text-red-400 font-bold text-right border border-border-accent p-1 text-base focus:outline-none focus:border-warning-accent appearance-none [-moz-appearance:textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none">
                    </div>
                    <!-- Slider -->
                    <input type="range" id="lightR" min="0" max="255" value="0"
                           class="w-full h-3 rounded-lg appearance-none cursor-pointer slider-track-red">
                </div>

                <!-- 綠光控制 -->
                <div class="mb-4">
                    <!-- Label and Input Field Container -->
                    <div class="flex justify-between items-center mb-1">
                        <label for="lightG" class="text-lg font-mono text-text-light">綠光強度 (Green light intensity)</label>
                        <!-- 數字輸入框 -->
                        <input type="number" id="inputG" min="0" max="255" value="0" 
                               class="w-20 bg-gray-700 text-green-400 font-bold text-right border border-border-accent p-1 text-base focus:outline-none focus:border-warning-accent appearance-none [-moz-appearance:textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none">
                    </div>
                    <!-- Slider -->
                    <input type="range" id="lightG" min="0" max="255" value="0"
                           class="w-full h-3 rounded-lg appearance-none cursor-pointer slider-track-green">
                </div>

                <!-- 藍光控制 -->
                <div class="mb-6">
                    <!-- Label and Input Field Container -->
                    <div class="flex justify-between items-center mb-1">
                        <label for="lightB" class="text-lg font-mono text-text-light">藍光強度 (Blue light intensity)</label>
                        <!-- 數字輸入框 -->
                        <input type="number" id="inputB" min="0" max="255" value="0" 
                               class="w-20 bg-gray-700 text-blue-400 font-bold text-right border border-border-accent p-1 text-base focus:outline-none focus:border-warning-accent appearance-none [-moz-appearance:textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none">
                    </div>
                    <!-- Slider -->
                    <input type="range" id="lightB" min="0" max="255" value="0"
                           class="w-full h-3 rounded-lg appearance-none cursor-pointer slider-track-blue">
                </div>

                <!-- 混合色光結果 (光照顏色顯示) -->
                <div class="p-4 bg-gray-700 rounded-sm border border-border-accent">
                    <p class="text-base font-semibold text-text-light mb-2">色光混合結果 (Color light mixing results):</p>
                    <div id="mixedLightColor" class="h-20 w-20 mx-auto rounded-full transition-all duration-300 border border-gray-500 shadow-xl"
                         style="background-color: rgb(0, 0, 0);"></div>
                    <p id="mixedLightHex" class="text-sm font-mono text-center mt-2 text-gray-700">HEX: #000000</p>
                </div>
            </div>

            <!-- 右側：物體與結果輸出面板 (國旗顯色模擬) -->
            <div class="bg-panel-bg p-6 rounded-sm border border-border-accent flex flex-col">
                <!-- 實驗 2 標題 -->
                <h2 class="text-xl font-semibold mb-6 text-warning-accent border-b border-border-accent pb-2">
                    2. 國旗(物體)在不同色光照射下的結果 (The results of the national flag (object) under different colors of light)
                </h2>
                
                <!-- 國旗選擇 (下拉式選單) -->
                <p class="text-base font-semibold text-text-light mb-3">選擇國旗 (Select national flag):</p>
                <!-- 下拉式選單容器 -->
                <div class="select-wrapper w-full mb-4">
                    <select id="flagSelect" class="w-full rounded-sm focus:ring-warning-accent focus:border-warning-accent">
                        <!-- Options will be injected by JS -->
                    </select>
                </div>

                <!-- 原有的國旗按鈕容器 (已移除，但保留 ID 以防 JS 邏輯依賴，並設置 hidden) -->
                <div class="hidden grid grid-cols-3 gap-3 mb-6" id="flagSelectionContainer">
                    <!-- Flags will be injected here by JS (or just the select element is used now) -->
                </div>

                <!-- 新增上傳圖片功能 -->
                <!-- 隱藏的檔案輸入框 -->
                <input type="file" id="imageUploadInput" accept="image/*" class="hidden">
                <!-- 顯示的按鈕 -->
                <button id="uploadImageButton" 
                    class="w-full py-2 mb-6 bg-warning-accent text-gray-900 font-bold text-base rounded-sm border border-warning-accent hover:bg-yellow-300 transition-colors">
                    上傳圖片 (Upload Image)
                </button>
                
                <!-- START: 國旗顯示區併排容器 -->
                <!-- 使用 grid-cols-1 sm:grid-cols-2 實現手機堆疊、平板以上併排 -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

                    <!-- 左側：當前國旗在白光下的顏色顯示 (Intrinsic Color) -->
                    <!-- 縮小 padding 和 font size -->
                    <div class="p-3 bg-gray-700 rounded-sm border border-border-accent">
                        <p class="text-sm font-semibold text-text-light mb-2">國旗(物體)在白光照射下的顏色 (Intrinsic Color):</p>
                        <div class="flex items-start space-x-3">
                            <!-- 國旗圖片顯示區 (縮小尺寸 h-24 -> h-16, w-36 -> w-24) -->
                            <div id="intrinsicFlagDisplay" class="h-16 w-24 flex-shrink-0 border border-border-accent shadow-md rounded-sm overflow-hidden bg-gray-900">
                                <img id="intrinsicFlagImage" src="" alt="Selected flag" class="w-full h-full object-contain">
                            </div>
                            <!-- 國旗名稱顯示區 (縮小字體 text-lg -> text-base, text-sm -> text-xs) -->
                            <div class="flex flex-col justify-center h-16">
                                <p id="intrinsicFlagCountry" class="text-base font-bold text-text-light">國家 (Country)</p>
                                <p id="intrinsicFlagEnglish" class="text-xs font-mono text-gray-400">(English Name)</p>
                            </div>
                        </div>
                    </div>

                    <!-- 右側：國旗最終顯色結果 (Apparent Color) -->
                    <!-- 縮小 padding 和 font size，並調整 Apparent Object Display Area 的高度 -->
                    <div class="p-3 bg-gray-800 rounded-sm border-2 border-warning-accent shadow-inner">
                        <!-- 標題縮小 -->
                        <h3 class="text-lg font-bold text-warning-accent mb-2 text-center">
                            3. 觀察者看到的國旗(物體)顏色 (Apparent Color)
                        </h3>
                        
                        <!-- 黑色背景容器 (Apparent Object Display) (高度縮小 h-48 -> h-36) -->
                        <div id="apparentObjectDisplayArea" 
                              class="h-36 w-full flex items-center justify-center bg-black rounded-sm border-4 border-gray-600 shadow-inner relative overflow-hidden">
                            
                            <!-- 1. 國旗基礎圖片 (作為底色) -->
                            <img id="apparentFlagImage" src="" alt="Apparent Flag" class="w-full h-full object-contain">
                            
                            <!-- 2. 模擬色光圖層 (將會被混合模式作用) -->
                            <div id="apparentLightOverlay" class="light-overlay" style="background-color: rgb(0, 0, 0);"></div>
                        </div>
                        
                        <p class="text-xs font-mono text-center mt-2 text-text-light">
                            <!-- 提示用戶目前使用的色光 (縮小字體) -->
                            <span class="text-gray-400">當前光色 (Current Light): </span>
                            <span id="currentLightRgbDisplay" class="font-bold text-warning-accent">RGB(0, 0, 0)</span>
                        </p>
                    </div>

                </div>
                <!-- END: 國旗顯示區併排容器 -->
            </div>
        </div>
    </div>

    <!-- 新增的 Footer 標示 -->
    <footer class="w-full max-w-5xl mx-auto mt-8 p-3 text-center text-xs text-gray-400 border-t border-border-accent">
        Made by 傑哥老師（紅樓老頭子）ccjhsntpc@gmail.com
    </footer>

    <script>
        // 國旗數據：包含名稱、英文和圖片 URL
        const flagData = {
            'taiwan': { id: 'taiwan', country: '中華民國', english: 'Republic of China', url: 'https://bluecyj.github.io/light/taiwan.png' },
            'japan': { id: 'japan', country: '日本', english: 'Japan', url: 'https://bluecyj.github.io/light/japan.png' },
            'korea': { id: 'korea', country: '韓國', english: 'Republic of Korea', url: 'https://bluecyj.github.io/light/south_korea.png' },
            'france': { id: 'france', country: '法國', english: 'French Republic', url: 'https://bluecyj.github.io/light/france.png' },
            'italy': { id: 'italy', country: '義大利', english: 'Italian Republic', url: 'https://bluecyj.github.io/light/italy_flag.png' },
            'romania': { id: 'romania', country: '羅馬尼亞', english: 'Romania', url: 'https://bluecyj.github.io/light/romania.png' }
        };

        // 預設選擇的國旗
        let currentFlagKey = 'taiwan'; 
        // 儲存用戶上傳圖片的 Base64 URL
        let customImageUrl = ''; 

        // 取得 UI 元素
        const lightRInput = document.getElementById('lightR');
        const lightGInput = document.getElementById('lightG');
        const lightBInput = document.getElementById('lightB');
        // 取得新增的數字輸入框
        const inputR = document.getElementById('inputR');
        const inputG = document.getElementById('inputG');
        const inputB = document.getElementById('inputB');
        
        const mixedLightColorDiv = document.getElementById('mixedLightColor');
        const mixedLightHexP = document.getElementById('mixedLightHex');
        
        // 國旗相關顯示元素
        const intrinsicFlagDisplay = document.getElementById('intrinsicFlagDisplay');
        const intrinsicFlagImage = document.getElementById('intrinsicFlagImage');
        const intrinsicFlagCountry = document.getElementById('intrinsicFlagCountry');
        const intrinsicFlagEnglish = document.getElementById('intrinsicFlagEnglish');
        const apparentFlagImage = document.getElementById('apparentFlagImage');
        const apparentLightOverlay = document.getElementById('apparentLightOverlay');
        const currentLightRgbDisplay = document.getElementById('currentLightRgbDisplay');
        
        // **修正：使用新的下拉式選單元素**
        const flagSelect = document.getElementById('flagSelect');

        // 原有的國旗按鈕容器 (現在是 hidden)
        const flagSelectionContainer = document.getElementById('flagSelectionContainer'); 

        // 新增的圖片上傳元素
        const imageUploadInput = document.getElementById('imageUploadInput');
        const uploadImageButton = document.getElementById('uploadImageButton');

        /**
         * 將 RGB 值轉換為 HEX 字串
         */
        function rgbToHex(r, g, b) {
            const toHex = (c) => Math.min(255, Math.max(0, Math.round(c))).toString(16).padStart(2, '0').toUpperCase();
            return `HEX: #${toHex(r)}${toHex(g)}${toHex(b)}`;
        }

        /**
         * 核心邏輯：更新所有顏色顯示和國旗顯色效果
         */
        function updateColors() {
            // 1. 取得入射色光強度 (0-255)
            const lightR = parseInt(lightRInput.value);
            const lightG = parseInt(lightGInput.value);
            const lightB = parseInt(lightBInput.value);

            // 更新數字輸入框數值 (同步滑桿到輸入框)
            inputR.value = lightR;
            inputG.value = lightG;
            inputB.value = lightB;

            // 2. 計算混合色光 (加法混色)
            const mixedLightRgb = `rgb(${lightR}, ${lightG}, ${lightB})`;
            const mixedLightHex = rgbToHex(lightR, lightG, lightB);

            mixedLightColorDiv.style.backgroundColor = mixedLightRgb;
            mixedLightHexP.textContent = mixedLightHex;
            currentLightRgbDisplay.textContent = `RGB(${lightR}, ${lightG}, ${lightB})`;
            
            // 3. 更新混合色光結果的文字顏色
            const mixedBrightness = (lightR + lightG + lightB) / 3;
            if (mixedBrightness < 128) {
                mixedLightHexP.classList.add('text-text-light');
                mixedLightHexP.classList.remove('text-gray-900');
            } else {
                mixedLightHexP.classList.remove('text-text-light');
                mixedLightHexP.classList.add('text-gray-900');
            }

            // 4. 模擬國旗在色光下的外觀顏色 (使用 CSS mix-blend-mode)
            // 將混合光色作為一個 overlay 圖層的背景色
            apparentLightOverlay.style.backgroundColor = mixedLightRgb;
        }

        /**
         * 處理數字輸入框變化，並同步到滑桿
         */
        function handleNumberInput(inputElement, sliderElement) {
            let value = parseInt(inputElement.value);
            
            // 驗證並限制數值在 0-255 之間
            if (isNaN(value) || value < 0) {
                value = 0;
            } else if (value > 255) {
                value = 255;
            }
            
            // 更新滑桿值
            sliderElement.value = value; 
            
            // 確保輸入框顯示的是限制後的數值
            inputElement.value = value; 
            
            // 觸發顏色更新
            updateColors();
        }

        /**
         * 處理圖片上傳事件
         */
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    customImageUrl = e.target.result;
                    
                    // 新增選項到下拉選單並選中
                    if (!document.getElementById('option-custom')) {
                        const option = document.createElement('option');
                        option.value = 'custom';
                        option.textContent = '自定義圖片 (Custom Image)';
                        option.id = 'option-custom';
                        flagSelect.appendChild(option);
                    }
                    flagSelect.value = 'custom'; 
                    
                    // 觸發 selectFlag 更新 UI
                    selectFlag('custom'); 
                    
                    // 清空 input 值，以便使用者再次選擇同一張圖片時仍能觸發 change 事件
                    imageUploadInput.value = ''; 
                };
                reader.readAsDataURL(file);
            }
        }

        /**
         * 設置當前國旗/圖片並更新 UI
         * @param {string} key - 國旗的鍵 (e.g., 'taiwan') 或 'custom'
         */
        function selectFlag(key) {
            currentFlagKey = key;
            let url, country, english;

            if (key === 'custom') {
                url = customImageUrl;
                country = '自定義圖片';
                english = 'Custom Image';
                // 如果還沒有上傳圖片，則不執行任何操作
                if (!url) {
                    flagSelect.value = 'taiwan'; // 復原為預設選項
                    selectFlag('taiwan');
                    return; 
                } 
            } else {
                const flag = flagData[key];
                url = flag.url;
                country = flag.country;
                english = flag.english;
                // 如果選擇了預設國旗，清除自定義圖片狀態（但保留 option 以備下次選擇）
                // customImageUrl = ''; 
            }

            // 1. 更新國旗在白光下的顯示區
            intrinsicFlagImage.src = url;
            intrinsicFlagImage.alt = country;
            intrinsicFlagCountry.textContent = country;
            intrinsicFlagEnglish.textContent = `(${english})`;

            // 2. 更新觀察者看到的國旗顯示區
            apparentFlagImage.src = url;
            apparentFlagImage.alt = `Apparent ${country}`;

            // 3. 更新下拉選單的選中狀態
            flagSelect.value = key;
            
            updateColors(); // 重新計算顯色效果
        }

        /**
         * 初始化國旗選擇下拉選單
         */
        function initializeFlagSelect() {
            flagSelect.innerHTML = ''; // 清空現有內容

            // 創建並添加選項
            Object.values(flagData).forEach((flag) => {
                const option = document.createElement('option');
                option.value = flag.id;
                option.textContent = `${flag.country} (${flag.english})`;
                flagSelect.appendChild(option);
            });
            
            // 綁定下拉選單的 change 事件
            flagSelect.addEventListener('change', (event) => {
                selectFlag(event.target.value);
            });
            
            // 預設選擇第一面國旗 (中華民國)
            selectFlag(currentFlagKey);
        }

        // 綁定事件監聽器 (滑桿)
        [lightRInput, lightGInput, lightBInput].forEach(input => {
            input.addEventListener('input', updateColors);
        });

        // 綁定事件監聽器 (數字輸入框)
        inputR.addEventListener('input', () => handleNumberInput(inputR, lightRInput));
        inputG.addEventListener('input', () => handleNumberInput(inputG, lightGInput));
        inputB.addEventListener('input', () => handleNumberInput(inputB, lightBInput));

        // 綁定圖片上傳按鈕事件
        uploadImageButton.addEventListener('click', () => {
            imageUploadInput.click(); // 點擊按鈕時觸發隱藏的檔案輸入框
        });

        // 綁定圖片選擇事件
        imageUploadInput.addEventListener('change', handleImageUpload);

        // 初始化
        initializeFlagSelect(); // 初始化下拉選單
    </script>
</body>
</html>